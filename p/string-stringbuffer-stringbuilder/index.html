<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="å¯¹æ¯” ç‰¹æ€§ String StringBuffer StringBuilder å¯å˜æ€§ ä¸å¯å˜ å¯å˜ å¯å˜ çº¿ç¨‹å®‰å…¨ æ˜¯ï¼ˆå¤©ç„¶ä¸å¯å˜ï¼‰ æ˜¯ï¼ˆsynchronizedæ–¹æ³•ï¼‰ å¦ æ€§èƒ½ ä½ï¼ˆé¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼‰ ä¸­ é«˜ å†…å­˜åˆ†é… æ¯æ¬¡ä¿®æ”¹äº§ç”Ÿæ–°å¯¹è±¡ åŠ¨æ€æ•°ç»„ åŠ¨æ€æ•°ç»„ åˆå§‹åŒ–å®¹é‡ ä¸å¯è®¾ç½® é»˜è®¤16ï¼Œå¯è‡ªå®šä¹‰ é»˜è®¤16ï¼Œå¯è‡ªå®šä¹‰ JDKç‰ˆæœ¬ 1.0 1.0 1.5 ä½¿ç”¨åœºæ™¯ å¸¸é‡å­—ç¬¦ä¸²ã€é…ç½®ä¿¡æ¯ å¤šçº¿ç¨‹ç¯å¢ƒå­—ç¬¦ä¸²æ“ä½œ å•çº¿ç¨‹ç¯å¢ƒå­—ç¬¦ä¸²æ“ä½œ å®ç°åˆ†æ Javaå­—ç¬¦ä¸²ä½“ç³»ç»“æ„\n1 2 3 4 5 6 7 8 9 10 11 12 13 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ String â”‚ â”‚ AbstractStringBuilder â”‚ â”‚-----------â”‚ â”‚-----------------------â”‚ â”‚ - value[] â”‚<â”€â”€â”€â”€â”€â”€>â”‚ + value[] â”‚ â”‚ - hash â”‚ â”‚ + count â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â–¼ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ StringBuffer â”‚ â”‚ StringBuilder â”‚ â”‚---------------â”‚ â”‚-----------------â”‚ â”‚ + sync methodsâ”‚ â”‚ - non-sync â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ String 1 2 3 4 5 6 7 8 9 10 11 public final class String implements java.io.Serializable, Comparable<String>, CharSequence { /** å®é™…å­˜å‚¨æ•°æ®çš„ä¸å¯å˜æ•°ç»„ */ // jdk9 ä¹‹å‰ private final char value[]; // jdk9 ä¹‹å private final byte[] value; /** å­—ç¬¦ä¸²çš„å“ˆå¸Œç ç¼“å­˜ */ private int hash; // Default to 0 } ä¸å¯å˜æ€§ï¼švalueæ•°ç»„è¢«å£°æ˜ä¸ºfinalï¼Œä»»ä½•ä¿®æ”¹éƒ½ä¼šåˆ›å»ºæ–°å¯¹è±¡ å†…å­˜ä¼˜åŒ–ï¼šä»JDK9å¼€å§‹æ”¹ç”¨byte[]å­˜å‚¨ï¼Œæ”¯æŒLATIN1/UTF-16ç¼–ç  å¸¸é‡æ± ï¼šå­—ç¬¦ä¸²å­—é¢é‡è‡ªåŠ¨åŠ å…¥å¸¸é‡æ± ï¼Œå‡å°‘é‡å¤åˆ›å»º StringBuffer & StringBuilder 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 abstract class AbstractStringBuilder { /** åŠ¨æ€æ•°ç»„å­˜å‚¨å­—ç¬¦æ•°æ® */ byte[] value; /** å½“å‰å·²ä½¿ç”¨çš„å­—ç¬¦æ•° */ int count; } public final class StringBuffer extends AbstractStringBuilder implements Serializable, CharSequence { // æ‰€æœ‰æ–¹æ³•æ·»åŠ synchronizedå…³é”®å­— @Override public synchronized StringBuffer append(String str) { super.append(str); return this; } } public final class StringBuilder extends AbstractStringBuilder implements Serializable, CharSequence { // éçº¿ç¨‹å®‰å…¨å®ç° @Override public StringBuilder append(String str) { super.append(str); return this; } } åŠ¨æ€æ‰©å®¹ï¼šåˆå§‹å®¹é‡16ï¼ˆå­—ç¬¦æ•°ï¼‰ çº¿ç¨‹å®‰å…¨ï¼šStringBufferé€šè¿‡æ–¹æ³•çº§åŒæ­¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ˆsynchronized å…³é”®å­—ä¿®é¥°ï¼‰ ç»§æ‰¿æŠ½è±¡ç±»ï¼šStringBufferå’ŒStringBuilderéƒ½ç»§æ‰¿äº†AbstractStringBuilder æ‰©å®¹åˆ†æï¼ŒåŸºäºjdk17 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 // å…¬å¼€çš„å®¹é‡ç¡®è®¤æ–¹æ³• public void ensureCapacity(int minimumCapacity) { if (minimumCapacity > 0) { // è¿‡æ»¤æ— æ•ˆå‚æ•° ensureCapacityInternal(minimumCapacity); // è°ƒç”¨å†…éƒ¨æ‰©å®¹é€»è¾‘ } } // å†…éƒ¨æ‰©å®¹å®ç° private void ensureCapacityInternal(int minimumCapacity) { // è®¡ç®—å½“å‰å­—ç¬¦å®¹é‡ï¼ˆå­—èŠ‚é•¿åº¦ >> ç¼–ç ä½æ•°ï¼‰ int oldCapacity = value.length >> coder; // éœ€è¦æ‰©å®¹çš„æ¡ä»¶åˆ¤æ–­ if (minimumCapacity - oldCapacity > 0) { // åˆ›å»ºæ–°æ•°ç»„å¹¶å¤åˆ¶æ•°æ® value = Arrays.copyOf(value, newCapacity(minimumCapacity) << coder); } } // æ–°å®¹é‡è®¡ç®—é€»è¾‘ private int newCapacity(int minCapacity) { // å½“å‰æ•°ç»„çš„å­—èŠ‚é•¿åº¦ int oldLength = value.length; // è®¡ç®—æ‰€éœ€çš„æœ€å°å­—èŠ‚é•¿åº¦ï¼ˆå­—ç¬¦æ•° << ç¼–ç ä½æ•°ï¼‰ int newLength = minCapacity << coder; // éœ€è¦æ‰©å±•çš„å­—èŠ‚æ•° int growth = newLength - oldLength; // åŠ¨æ€è®¡ç®—æ–°å®¹é‡ï¼ˆæ ¸å¿ƒæ‰©å®¹ç®—æ³•ï¼‰ int length = ArraysSupport.newLength(oldLength, growth, oldLength + (2 << coder)); // é»˜è®¤æ‰©å±•é‡ // å¤„ç†æœ€å¤§å®¹é‡é™åˆ¶ if (length == Integer.MAX_VALUE) { throw new OutOfMemoryError(...); } // è¿”å›å­—ç¬¦å®¹é‡ï¼ˆå­—èŠ‚é•¿åº¦ >> ç¼–ç ä½æ•°ï¼‰ return length >> coder; } ç¼–ç å¤„ç†ï¼ˆcoderå­—æ®µï¼‰ï¼š\n"><title>String/StringBuffer/StringBuilder</title>
<link rel=canonical href=https://codeSu97.github.io/p/string-stringbuffer-stringbuilder/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="String/StringBuffer/StringBuilder"><meta property='og:description' content="å¯¹æ¯” ç‰¹æ€§ String StringBuffer StringBuilder å¯å˜æ€§ ä¸å¯å˜ å¯å˜ å¯å˜ çº¿ç¨‹å®‰å…¨ æ˜¯ï¼ˆå¤©ç„¶ä¸å¯å˜ï¼‰ æ˜¯ï¼ˆsynchronizedæ–¹æ³•ï¼‰ å¦ æ€§èƒ½ ä½ï¼ˆé¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼‰ ä¸­ é«˜ å†…å­˜åˆ†é… æ¯æ¬¡ä¿®æ”¹äº§ç”Ÿæ–°å¯¹è±¡ åŠ¨æ€æ•°ç»„ åŠ¨æ€æ•°ç»„ åˆå§‹åŒ–å®¹é‡ ä¸å¯è®¾ç½® é»˜è®¤16ï¼Œå¯è‡ªå®šä¹‰ é»˜è®¤16ï¼Œå¯è‡ªå®šä¹‰ JDKç‰ˆæœ¬ 1.0 1.0 1.5 ä½¿ç”¨åœºæ™¯ å¸¸é‡å­—ç¬¦ä¸²ã€é…ç½®ä¿¡æ¯ å¤šçº¿ç¨‹ç¯å¢ƒå­—ç¬¦ä¸²æ“ä½œ å•çº¿ç¨‹ç¯å¢ƒå­—ç¬¦ä¸²æ“ä½œ å®ç°åˆ†æ Javaå­—ç¬¦ä¸²ä½“ç³»ç»“æ„\n1 2 3 4 5 6 7 8 9 10 11 12 13 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ String â”‚ â”‚ AbstractStringBuilder â”‚ â”‚-----------â”‚ â”‚-----------------------â”‚ â”‚ - value[] â”‚<â”€â”€â”€â”€â”€â”€>â”‚ + value[] â”‚ â”‚ - hash â”‚ â”‚ + count â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â–¼ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ StringBuffer â”‚ â”‚ StringBuilder â”‚ â”‚---------------â”‚ â”‚-----------------â”‚ â”‚ + sync methodsâ”‚ â”‚ - non-sync â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ String 1 2 3 4 5 6 7 8 9 10 11 public final class String implements java.io.Serializable, Comparable<String>, CharSequence { /** å®é™…å­˜å‚¨æ•°æ®çš„ä¸å¯å˜æ•°ç»„ */ // jdk9 ä¹‹å‰ private final char value[]; // jdk9 ä¹‹å private final byte[] value; /** å­—ç¬¦ä¸²çš„å“ˆå¸Œç ç¼“å­˜ */ private int hash; // Default to 0 } ä¸å¯å˜æ€§ï¼švalueæ•°ç»„è¢«å£°æ˜ä¸ºfinalï¼Œä»»ä½•ä¿®æ”¹éƒ½ä¼šåˆ›å»ºæ–°å¯¹è±¡ å†…å­˜ä¼˜åŒ–ï¼šä»JDK9å¼€å§‹æ”¹ç”¨byte[]å­˜å‚¨ï¼Œæ”¯æŒLATIN1/UTF-16ç¼–ç  å¸¸é‡æ± ï¼šå­—ç¬¦ä¸²å­—é¢é‡è‡ªåŠ¨åŠ å…¥å¸¸é‡æ± ï¼Œå‡å°‘é‡å¤åˆ›å»º StringBuffer & StringBuilder 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 abstract class AbstractStringBuilder { /** åŠ¨æ€æ•°ç»„å­˜å‚¨å­—ç¬¦æ•°æ® */ byte[] value; /** å½“å‰å·²ä½¿ç”¨çš„å­—ç¬¦æ•° */ int count; } public final class StringBuffer extends AbstractStringBuilder implements Serializable, CharSequence { // æ‰€æœ‰æ–¹æ³•æ·»åŠ synchronizedå…³é”®å­— @Override public synchronized StringBuffer append(String str) { super.append(str); return this; } } public final class StringBuilder extends AbstractStringBuilder implements Serializable, CharSequence { // éçº¿ç¨‹å®‰å…¨å®ç° @Override public StringBuilder append(String str) { super.append(str); return this; } } åŠ¨æ€æ‰©å®¹ï¼šåˆå§‹å®¹é‡16ï¼ˆå­—ç¬¦æ•°ï¼‰ çº¿ç¨‹å®‰å…¨ï¼šStringBufferé€šè¿‡æ–¹æ³•çº§åŒæ­¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ˆsynchronized å…³é”®å­—ä¿®é¥°ï¼‰ ç»§æ‰¿æŠ½è±¡ç±»ï¼šStringBufferå’ŒStringBuilderéƒ½ç»§æ‰¿äº†AbstractStringBuilder æ‰©å®¹åˆ†æï¼ŒåŸºäºjdk17 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 // å…¬å¼€çš„å®¹é‡ç¡®è®¤æ–¹æ³• public void ensureCapacity(int minimumCapacity) { if (minimumCapacity > 0) { // è¿‡æ»¤æ— æ•ˆå‚æ•° ensureCapacityInternal(minimumCapacity); // è°ƒç”¨å†…éƒ¨æ‰©å®¹é€»è¾‘ } } // å†…éƒ¨æ‰©å®¹å®ç° private void ensureCapacityInternal(int minimumCapacity) { // è®¡ç®—å½“å‰å­—ç¬¦å®¹é‡ï¼ˆå­—èŠ‚é•¿åº¦ >> ç¼–ç ä½æ•°ï¼‰ int oldCapacity = value.length >> coder; // éœ€è¦æ‰©å®¹çš„æ¡ä»¶åˆ¤æ–­ if (minimumCapacity - oldCapacity > 0) { // åˆ›å»ºæ–°æ•°ç»„å¹¶å¤åˆ¶æ•°æ® value = Arrays.copyOf(value, newCapacity(minimumCapacity) << coder); } } // æ–°å®¹é‡è®¡ç®—é€»è¾‘ private int newCapacity(int minCapacity) { // å½“å‰æ•°ç»„çš„å­—èŠ‚é•¿åº¦ int oldLength = value.length; // è®¡ç®—æ‰€éœ€çš„æœ€å°å­—èŠ‚é•¿åº¦ï¼ˆå­—ç¬¦æ•° << ç¼–ç ä½æ•°ï¼‰ int newLength = minCapacity << coder; // éœ€è¦æ‰©å±•çš„å­—èŠ‚æ•° int growth = newLength - oldLength; // åŠ¨æ€è®¡ç®—æ–°å®¹é‡ï¼ˆæ ¸å¿ƒæ‰©å®¹ç®—æ³•ï¼‰ int length = ArraysSupport.newLength(oldLength, growth, oldLength + (2 << coder)); // é»˜è®¤æ‰©å±•é‡ // å¤„ç†æœ€å¤§å®¹é‡é™åˆ¶ if (length == Integer.MAX_VALUE) { throw new OutOfMemoryError(...); } // è¿”å›å­—ç¬¦å®¹é‡ï¼ˆå­—èŠ‚é•¿åº¦ >> ç¼–ç ä½æ•°ï¼‰ return length >> coder; } ç¼–ç å¤„ç†ï¼ˆcoderå­—æ®µï¼‰ï¼š\n"><meta property='og:url' content='https://codeSu97.github.io/p/string-stringbuffer-stringbuilder/'><meta property='og:site_name' content='XiaoYp - Blog'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Java'><meta property='article:tag' content='String'><meta property='article:tag' content='StringBuffer'><meta property='article:tag' content='StringBuilder'><meta property='article:published_time' content='2024-03-25T14:36:56+08:00'><meta property='article:modified_time' content='2024-03-25T14:36:56+08:00'><meta name=twitter:title content="String/StringBuffer/StringBuilder"><meta name=twitter:description content="å¯¹æ¯” ç‰¹æ€§ String StringBuffer StringBuilder å¯å˜æ€§ ä¸å¯å˜ å¯å˜ å¯å˜ çº¿ç¨‹å®‰å…¨ æ˜¯ï¼ˆå¤©ç„¶ä¸å¯å˜ï¼‰ æ˜¯ï¼ˆsynchronizedæ–¹æ³•ï¼‰ å¦ æ€§èƒ½ ä½ï¼ˆé¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼‰ ä¸­ é«˜ å†…å­˜åˆ†é… æ¯æ¬¡ä¿®æ”¹äº§ç”Ÿæ–°å¯¹è±¡ åŠ¨æ€æ•°ç»„ åŠ¨æ€æ•°ç»„ åˆå§‹åŒ–å®¹é‡ ä¸å¯è®¾ç½® é»˜è®¤16ï¼Œå¯è‡ªå®šä¹‰ é»˜è®¤16ï¼Œå¯è‡ªå®šä¹‰ JDKç‰ˆæœ¬ 1.0 1.0 1.5 ä½¿ç”¨åœºæ™¯ å¸¸é‡å­—ç¬¦ä¸²ã€é…ç½®ä¿¡æ¯ å¤šçº¿ç¨‹ç¯å¢ƒå­—ç¬¦ä¸²æ“ä½œ å•çº¿ç¨‹ç¯å¢ƒå­—ç¬¦ä¸²æ“ä½œ å®ç°åˆ†æ Javaå­—ç¬¦ä¸²ä½“ç³»ç»“æ„\n1 2 3 4 5 6 7 8 9 10 11 12 13 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ String â”‚ â”‚ AbstractStringBuilder â”‚ â”‚-----------â”‚ â”‚-----------------------â”‚ â”‚ - value[] â”‚<â”€â”€â”€â”€â”€â”€>â”‚ + value[] â”‚ â”‚ - hash â”‚ â”‚ + count â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â–¼ â–¼ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ StringBuffer â”‚ â”‚ StringBuilder â”‚ â”‚---------------â”‚ â”‚-----------------â”‚ â”‚ + sync methodsâ”‚ â”‚ - non-sync â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ String 1 2 3 4 5 6 7 8 9 10 11 public final class String implements java.io.Serializable, Comparable<String>, CharSequence { /** å®é™…å­˜å‚¨æ•°æ®çš„ä¸å¯å˜æ•°ç»„ */ // jdk9 ä¹‹å‰ private final char value[]; // jdk9 ä¹‹å private final byte[] value; /** å­—ç¬¦ä¸²çš„å“ˆå¸Œç ç¼“å­˜ */ private int hash; // Default to 0 } ä¸å¯å˜æ€§ï¼švalueæ•°ç»„è¢«å£°æ˜ä¸ºfinalï¼Œä»»ä½•ä¿®æ”¹éƒ½ä¼šåˆ›å»ºæ–°å¯¹è±¡ å†…å­˜ä¼˜åŒ–ï¼šä»JDK9å¼€å§‹æ”¹ç”¨byte[]å­˜å‚¨ï¼Œæ”¯æŒLATIN1/UTF-16ç¼–ç  å¸¸é‡æ± ï¼šå­—ç¬¦ä¸²å­—é¢é‡è‡ªåŠ¨åŠ å…¥å¸¸é‡æ± ï¼Œå‡å°‘é‡å¤åˆ›å»º StringBuffer & StringBuilder 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 abstract class AbstractStringBuilder { /** åŠ¨æ€æ•°ç»„å­˜å‚¨å­—ç¬¦æ•°æ® */ byte[] value; /** å½“å‰å·²ä½¿ç”¨çš„å­—ç¬¦æ•° */ int count; } public final class StringBuffer extends AbstractStringBuilder implements Serializable, CharSequence { // æ‰€æœ‰æ–¹æ³•æ·»åŠ synchronizedå…³é”®å­— @Override public synchronized StringBuffer append(String str) { super.append(str); return this; } } public final class StringBuilder extends AbstractStringBuilder implements Serializable, CharSequence { // éçº¿ç¨‹å®‰å…¨å®ç° @Override public StringBuilder append(String str) { super.append(str); return this; } } åŠ¨æ€æ‰©å®¹ï¼šåˆå§‹å®¹é‡16ï¼ˆå­—ç¬¦æ•°ï¼‰ çº¿ç¨‹å®‰å…¨ï¼šStringBufferé€šè¿‡æ–¹æ³•çº§åŒæ­¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ˆsynchronized å…³é”®å­—ä¿®é¥°ï¼‰ ç»§æ‰¿æŠ½è±¡ç±»ï¼šStringBufferå’ŒStringBuilderéƒ½ç»§æ‰¿äº†AbstractStringBuilder æ‰©å®¹åˆ†æï¼ŒåŸºäºjdk17 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 // å…¬å¼€çš„å®¹é‡ç¡®è®¤æ–¹æ³• public void ensureCapacity(int minimumCapacity) { if (minimumCapacity > 0) { // è¿‡æ»¤æ— æ•ˆå‚æ•° ensureCapacityInternal(minimumCapacity); // è°ƒç”¨å†…éƒ¨æ‰©å®¹é€»è¾‘ } } // å†…éƒ¨æ‰©å®¹å®ç° private void ensureCapacityInternal(int minimumCapacity) { // è®¡ç®—å½“å‰å­—ç¬¦å®¹é‡ï¼ˆå­—èŠ‚é•¿åº¦ >> ç¼–ç ä½æ•°ï¼‰ int oldCapacity = value.length >> coder; // éœ€è¦æ‰©å®¹çš„æ¡ä»¶åˆ¤æ–­ if (minimumCapacity - oldCapacity > 0) { // åˆ›å»ºæ–°æ•°ç»„å¹¶å¤åˆ¶æ•°æ® value = Arrays.copyOf(value, newCapacity(minimumCapacity) << coder); } } // æ–°å®¹é‡è®¡ç®—é€»è¾‘ private int newCapacity(int minCapacity) { // å½“å‰æ•°ç»„çš„å­—èŠ‚é•¿åº¦ int oldLength = value.length; // è®¡ç®—æ‰€éœ€çš„æœ€å°å­—èŠ‚é•¿åº¦ï¼ˆå­—ç¬¦æ•° << ç¼–ç ä½æ•°ï¼‰ int newLength = minCapacity << coder; // éœ€è¦æ‰©å±•çš„å­—èŠ‚æ•° int growth = newLength - oldLength; // åŠ¨æ€è®¡ç®—æ–°å®¹é‡ï¼ˆæ ¸å¿ƒæ‰©å®¹ç®—æ³•ï¼‰ int length = ArraysSupport.newLength(oldLength, growth, oldLength + (2 << coder)); // é»˜è®¤æ‰©å±•é‡ // å¤„ç†æœ€å¤§å®¹é‡é™åˆ¶ if (length == Integer.MAX_VALUE) { throw new OutOfMemoryError(...); } // è¿”å›å­—ç¬¦å®¹é‡ï¼ˆå­—èŠ‚é•¿åº¦ >> ç¼–ç ä½æ•°ï¼‰ return length >> coder; } ç¼–ç å¤„ç†ï¼ˆcoderå­—æ®µï¼‰ï¼š\n"><link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/37898221?v=4"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky compact"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src="https://avatars.githubusercontent.com/u/37898221?v=4" width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ‡¨ğŸ‡³</span></figure><div class=site-meta><h1 class=site-name><a href=/>XiaoYp - Blog</a></h1><h2 class=site-description>æƒ³éƒ½æ˜¯é—®é¢˜ï¼Œåšæ‰æ˜¯ç­”æ¡ˆ</h2></div></header><ol class=menu-social><li><a href=https://github.com/XiaoYp97 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>å…³äº</span></a></li><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>é¦–é¡µ</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>é“¾æ¥</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#å¯¹æ¯”>å¯¹æ¯”</a></li><li><a href=#å®ç°åˆ†æ>å®ç°åˆ†æ</a><ol><li><a href=#string>String</a></li><li><a href=#stringbuffer--stringbuilder>StringBuffer & StringBuilder</a><ol><li><a href=#æ‰©å®¹åˆ†æåŸºäºjdk17>æ‰©å®¹åˆ†æï¼ŒåŸºäºjdk17</a></li><li><a href=#æ‰©å®¹ç¤ºä¾‹>æ‰©å®¹ç¤ºä¾‹</a></li></ol></li><li><a href=#æ€§èƒ½æµ‹è¯•>æ€§èƒ½æµ‹è¯•</a><ol><li><a href=#æµ‹è¯•åœºæ™¯>æµ‹è¯•åœºæ™¯</a></li><li><a href=#æµ‹è¯•ç»“æœ>æµ‹è¯•ç»“æœ</a></li></ol></li></ol></li><li><a href=#æœ€ä½³å®è·µ>æœ€ä½³å®è·µ</a><ol><li><a href=#1-é€‰æ‹©ç­–ç•¥>1. é€‰æ‹©ç­–ç•¥</a></li><li><a href=#2-æ€§èƒ½ä¼˜åŒ–æŠ€å·§>2. æ€§èƒ½ä¼˜åŒ–æŠ€å·§</a></li><li><a href=#3-ç‰¹æ®Šåœºæ™¯å¤„ç†>3. ç‰¹æ®Šåœºæ™¯å¤„ç†</a></li></ol></li><li><a href=#å¸¸è§è¯¯åŒº>å¸¸è§è¯¯åŒº</a><ol><li><a href=#è¯¯åŒº1stringbuilderä¸€å®šæ¯”stringbufferå¿«>è¯¯åŒº1ï¼šStringBuilderä¸€å®šæ¯”StringBufferå¿«</a></li><li><a href=#è¯¯åŒº2stringbufferå¯ä»¥å®Œå…¨æ›¿ä»£stringbuilder>è¯¯åŒº2ï¼šStringBufferå¯ä»¥å®Œå…¨æ›¿ä»£StringBuilder</a></li></ol></li><li><a href=#è¿›é˜¶>è¿›é˜¶</a><ol><li><a href=#1-jdk9ä¼˜åŒ–æ”¹è¿›>1. JDK9ä¼˜åŒ–æ”¹è¿›</a></li><li><a href=#2-å†…å­˜æ³„æ¼é˜²èŒƒ>2. å†…å­˜æ³„æ¼é˜²èŒƒ</a></li><li><a href=#3-å­—ç¬¦ä¸²æ± æœºåˆ¶>3. å­—ç¬¦ä¸²æ± æœºåˆ¶</a></li></ol></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/java/>Java</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/string-stringbuffer-stringbuilder/>String/StringBuffer/StringBuilder</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2024-03-25</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 5 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h2 id=å¯¹æ¯”>å¯¹æ¯”</h2><div class=table-wrapper><table><thead><tr><th>ç‰¹æ€§</th><th>String</th><th>StringBuffer</th><th>StringBuilder</th></tr></thead><tbody><tr><td><strong>å¯å˜æ€§</strong></td><td>ä¸å¯å˜</td><td>å¯å˜</td><td>å¯å˜</td></tr><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>æ˜¯ï¼ˆå¤©ç„¶ä¸å¯å˜ï¼‰</td><td>æ˜¯ï¼ˆsynchronizedæ–¹æ³•ï¼‰</td><td>å¦</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>ä½ï¼ˆé¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼‰</td><td>ä¸­</td><td>é«˜</td></tr><tr><td><strong>å†…å­˜åˆ†é…</strong></td><td>æ¯æ¬¡ä¿®æ”¹äº§ç”Ÿæ–°å¯¹è±¡</td><td>åŠ¨æ€æ•°ç»„</td><td>åŠ¨æ€æ•°ç»„</td></tr><tr><td><strong>åˆå§‹åŒ–å®¹é‡</strong></td><td>ä¸å¯è®¾ç½®</td><td>é»˜è®¤16ï¼Œå¯è‡ªå®šä¹‰</td><td>é»˜è®¤16ï¼Œå¯è‡ªå®šä¹‰</td></tr><tr><td><strong>JDKç‰ˆæœ¬</strong></td><td>1.0</td><td>1.0</td><td>1.5</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>å¸¸é‡å­—ç¬¦ä¸²ã€é…ç½®ä¿¡æ¯</td><td>å¤šçº¿ç¨‹ç¯å¢ƒå­—ç¬¦ä¸²æ“ä½œ</td><td>å•çº¿ç¨‹ç¯å¢ƒå­—ç¬¦ä¸²æ“ä½œ</td></tr></tbody></table></div><h2 id=å®ç°åˆ†æ>å®ç°åˆ†æ</h2><p>Javaå­—ç¬¦ä¸²ä½“ç³»ç»“æ„</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>â”‚  String   â”‚        â”‚ AbstractStringBuilder â”‚
</span></span><span class=line><span class=cl>â”‚-----------â”‚        â”‚-----------------------â”‚
</span></span><span class=line><span class=cl>â”‚ - value[] â”‚&lt;â”€â”€â”€â”€â”€â”€&gt;â”‚ + value[]             â”‚
</span></span><span class=line><span class=cl>â”‚ - hash    â”‚        â”‚ + count               â”‚
</span></span><span class=line><span class=cl>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class=line><span class=cl>     â”‚                      â”‚
</span></span><span class=line><span class=cl>     â–¼                      â–¼
</span></span><span class=line><span class=cl>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>â”‚ StringBuffer  â”‚    â”‚  StringBuilder  â”‚
</span></span><span class=line><span class=cl>â”‚---------------â”‚    â”‚-----------------â”‚
</span></span><span class=line><span class=cl>â”‚ + sync methodsâ”‚    â”‚ - non-sync      â”‚
</span></span><span class=line><span class=cl>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table></div></div><h3 id=string>String</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>class</span> <span class=nc>String</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>implements</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Serializable</span><span class=p>,</span><span class=w> </span><span class=n>Comparable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>CharSequence</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/** å®é™…å­˜å‚¨æ•°æ®çš„ä¸å¯å˜æ•°ç»„ */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// jdk9 ä¹‹å‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=n>value</span><span class=o>[]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// jdk9 ä¹‹å</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/** å­—ç¬¦ä¸²çš„å“ˆå¸Œç ç¼“å­˜ */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>hash</span><span class=p>;</span><span class=w> </span><span class=c1>// Default to 0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>ä¸å¯å˜æ€§ï¼švalueæ•°ç»„è¢«å£°æ˜ä¸ºfinalï¼Œä»»ä½•ä¿®æ”¹éƒ½ä¼šåˆ›å»ºæ–°å¯¹è±¡</li><li>å†…å­˜ä¼˜åŒ–ï¼šä»JDK9å¼€å§‹æ”¹ç”¨byte[]å­˜å‚¨ï¼Œæ”¯æŒLATIN1/UTF-16ç¼–ç </li><li>å¸¸é‡æ± ï¼š<strong>å­—ç¬¦ä¸²å­—é¢é‡</strong>è‡ªåŠ¨åŠ å…¥å¸¸é‡æ± ï¼Œå‡å°‘é‡å¤åˆ›å»º</li></ul><h3 id=stringbuffer--stringbuilder>StringBuffer & StringBuilder</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>abstract</span><span class=w> </span><span class=kd>class</span> <span class=nc>AbstractStringBuilder</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/** åŠ¨æ€æ•°ç»„å­˜å‚¨å­—ç¬¦æ•°æ® */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/** å½“å‰å·²ä½¿ç”¨çš„å­—ç¬¦æ•° */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>class</span> <span class=nc>StringBuffer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>extends</span><span class=w> </span><span class=n>AbstractStringBuilder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=p>,</span><span class=w> </span><span class=n>CharSequence</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// æ‰€æœ‰æ–¹æ³•æ·»åŠ synchronizedå…³é”®å­—</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=n>StringBuffer</span><span class=w> </span><span class=nf>append</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>str</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>str</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>class</span> <span class=nc>StringBuilder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>extends</span><span class=w> </span><span class=n>AbstractStringBuilder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=p>,</span><span class=w> </span><span class=n>CharSequence</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// éçº¿ç¨‹å®‰å…¨å®ç°</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>StringBuilder</span><span class=w> </span><span class=nf>append</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>str</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>str</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>åŠ¨æ€æ‰©å®¹ï¼šåˆå§‹å®¹é‡16ï¼ˆå­—ç¬¦æ•°ï¼‰</li><li>çº¿ç¨‹å®‰å…¨ï¼šStringBufferé€šè¿‡æ–¹æ³•çº§åŒæ­¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ˆ<code>synchronized</code> å…³é”®å­—ä¿®é¥°ï¼‰</li><li>ç»§æ‰¿æŠ½è±¡ç±»ï¼šStringBufferå’ŒStringBuilderéƒ½ç»§æ‰¿äº†AbstractStringBuilder</li></ul><h4 id=æ‰©å®¹åˆ†æåŸºäºjdk17>æ‰©å®¹åˆ†æï¼ŒåŸºäºjdk17</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// å…¬å¼€çš„å®¹é‡ç¡®è®¤æ–¹æ³•</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>ensureCapacity</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>minimumCapacity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>minimumCapacity</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// è¿‡æ»¤æ— æ•ˆå‚æ•°</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ensureCapacityInternal</span><span class=p>(</span><span class=n>minimumCapacity</span><span class=p>);</span><span class=w> </span><span class=c1>// è°ƒç”¨å†…éƒ¨æ‰©å®¹é€»è¾‘</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å†…éƒ¨æ‰©å®¹å®ç°</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>ensureCapacityInternal</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>minimumCapacity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è®¡ç®—å½“å‰å­—ç¬¦å®¹é‡ï¼ˆå­—èŠ‚é•¿åº¦ &gt;&gt; ç¼–ç ä½æ•°ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>oldCapacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=na>length</span><span class=w> </span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>coder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// éœ€è¦æ‰©å®¹çš„æ¡ä»¶åˆ¤æ–­</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>minimumCapacity</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>oldCapacity</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// åˆ›å»ºæ–°æ•°ç»„å¹¶å¤åˆ¶æ•°æ®</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>copyOf</span><span class=p>(</span><span class=n>value</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>newCapacity</span><span class=p>(</span><span class=n>minimumCapacity</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>coder</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// æ–°å®¹é‡è®¡ç®—é€»è¾‘</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>newCapacity</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>minCapacity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// å½“å‰æ•°ç»„çš„å­—èŠ‚é•¿åº¦</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>oldLength</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è®¡ç®—æ‰€éœ€çš„æœ€å°å­—èŠ‚é•¿åº¦ï¼ˆå­—ç¬¦æ•° &lt;&lt; ç¼–ç ä½æ•°ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>newLength</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>minCapacity</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>coder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// éœ€è¦æ‰©å±•çš„å­—èŠ‚æ•°</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>growth</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>newLength</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>oldLength</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// åŠ¨æ€è®¡ç®—æ–°å®¹é‡ï¼ˆæ ¸å¿ƒæ‰©å®¹ç®—æ³•ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ArraysSupport</span><span class=p>.</span><span class=na>newLength</span><span class=p>(</span><span class=n>oldLength</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>growth</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>oldLength</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>2</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>coder</span><span class=p>));</span><span class=w> </span><span class=c1>// é»˜è®¤æ‰©å±•é‡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// å¤„ç†æœ€å¤§å®¹é‡é™åˆ¶</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>length</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>MAX_VALUE</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>OutOfMemoryError</span><span class=p>(...);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è¿”å›å­—ç¬¦å®¹é‡ï¼ˆå­—èŠ‚é•¿åº¦ &gt;&gt; ç¼–ç ä½æ•°ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>coder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><p><strong>ç¼–ç å¤„ç†ï¼ˆcoderå­—æ®µï¼‰</strong>ï¼š</p><ul><li><p><code>coder</code>å–å€¼0ï¼ˆLATIN1ï¼‰æˆ–1ï¼ˆUTF16BEï¼‰</p></li><li><p>ä½ç§»æ“ä½œå®ç°å­—èŠ‚ä¸å­—ç¬¦è½¬æ¢ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// å­—èŠ‚é•¿åº¦ â†’ å­—ç¬¦å®¹é‡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>int</span><span class=w> </span><span class=n>characters</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bytesLength</span><span class=w> </span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>coder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å­—ç¬¦å®¹é‡ â†’ å­—èŠ‚é•¿åº¦</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>int</span><span class=w> </span><span class=n>bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>characters</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>coder</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></li><li><p><strong>æ‰©å®¹ç­–ç•¥</strong>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ArraysSupport</span><span class=p>.</span><span class=na>newLength</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>oldLength</span><span class=p>,</span><span class=w>     </span><span class=c1>// å½“å‰æ•°ç»„é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>minGrowth</span><span class=p>,</span><span class=w>     </span><span class=c1>// è‡³å°‘éœ€è¦å¢é•¿çš„é‡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>prefGrowth</span><span class=w>     </span><span class=c1>// æ¨èå¢é•¿é‡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ArraysSupport</span><span class=p>.</span><span class=na>newLength</span><span class=p>(</span><span class=n>oldLength</span><span class=p>,</span><span class=w> </span><span class=n>growth</span><span class=p>,</span><span class=w> </span><span class=n>oldLength</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>2</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>coder</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>å®é™…æ‰©å®¹å…¬å¼ï¼š<code>æ–°é•¿åº¦ = oldLength + max(minGrowth, prefGrowth)</code></li><li>é»˜è®¤æ‰©å±•é‡è®¡ç®—ï¼š<code>prefGrowth = oldLength + (2 &lt;&lt; coder)</code><ul><li>LATIN1ç¼–ç æ—¶ï¼š+2å­—èŠ‚ï¼ˆå³æ‰©å®¹2å­—ç¬¦ï¼‰</li><li>UTF16ç¼–ç æ—¶ï¼š+4å­—èŠ‚ï¼ˆå³æ‰©å®¹2å­—ç¬¦ï¼‰</li></ul></li></ul></li><li><p><strong>åŠ¨æ€æ‰©å®¹æµç¨‹</strong>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>åŸå§‹æ•°ç»„ â†’ è®¡ç®—æœ€å°éœ€æ±‚ â†’
</span></span><span class=line><span class=cl>â”Œâ”€æ»¡è¶³éœ€æ±‚ â†’ ç›´æ¥è¿”å›
</span></span><span class=line><span class=cl>â””â”€éœ€è¦æ‰©å®¹ â†’ è®¡ç®—æ–°å®¹é‡ â†’
</span></span><span class=line><span class=cl>   â”œâ”€è¶…è¿‡é™åˆ¶ â†’ æŠ›å‡ºOOM
</span></span><span class=line><span class=cl>   â””â”€åˆ›å»ºæ–°æ•°ç»„ â†’ æ•°æ®å¤åˆ¶
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>æ€§èƒ½ä¼˜åŒ–ç‚¹</strong>ï¼š</p><ul><li><strong>å»¶è¿Ÿè®¡ç®—</strong>ï¼šåªåœ¨éœ€è¦æ‰©å®¹æ—¶è¿›è¡Œè®¡ç®—</li><li><strong>æŒ‰éœ€æ‰©å®¹</strong>ï¼šæ ¹æ®å®é™…å¢é•¿éœ€æ±‚åŠ¨æ€è°ƒæ•´</li><li><strong>ä½è¿ç®—ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ä½ç§»ä»£æ›¿ä¹˜é™¤è¿ç®—</li></ul></li></ol><h4 id=æ‰©å®¹ç¤ºä¾‹>æ‰©å®¹ç¤ºä¾‹</h4><p>å‡è®¾åŸå§‹çŠ¶æ€ï¼š</p><ul><li>ç¼–ç æ–¹å¼ï¼šUTF16ï¼ˆcoder=1ï¼‰</li><li>å½“å‰å†…å®¹ï¼š&ldquo;Hello&rdquo;ï¼ˆ5å­—ç¬¦ï¼‰</li><li>å½“å‰æ•°ç»„ï¼šchar[16]ï¼ˆåˆå§‹å®¹é‡16å­—ç¬¦ï¼‰</li></ul><p>æ‰§è¡Œappend(&ldquo;World!")åï¼š</p><ol><li>éœ€è¦æ€»å­—ç¬¦æ•°ï¼š5 + 6 = 11</li><li>å½“å‰å®¹é‡16è¶³å¤Ÿï¼Œæ— éœ€æ‰©å®¹</li></ol><p>ç»§ç»­è¿½åŠ æ•°æ®ç›´åˆ°éœ€è¦17å­—ç¬¦ï¼š</p><ol><li>è®¡ç®—æœ€å°å­—èŠ‚éœ€æ±‚ï¼š17 &lt;&lt; 1 = 34å­—èŠ‚</li><li>å½“å‰æ•°ç»„é•¿åº¦ï¼š16 &lt;&lt; 1 = 32å­—èŠ‚</li><li>è®¡ç®—growth = 34 - 32 = 2å­—èŠ‚</li><li>è®¡ç®—prefGrowthï¼š32 + (2 &lt;&lt; 1) = 36</li><li>æ–°é•¿åº¦ = 32 + max(2, 36-32) = 32 + 4 = 36å­—èŠ‚</li><li>æ–°å­—ç¬¦å®¹é‡ï¼š36 >> 1 = 18å­—ç¬¦</li></ol><p>æœ€ç»ˆå®Œæˆä»16åˆ°18å­—ç¬¦çš„æ‰©å®¹ï¼Œå®é™…æ‰©å®¹é‡æ˜¯åŸå§‹å®¹é‡çš„1.125å€ï¼Œè€Œéä¼ ç»Ÿçš„åŒå€æ‰©å®¹ã€‚</p><h3 id=æ€§èƒ½æµ‹è¯•>æ€§èƒ½æµ‹è¯•</h3><h4 id=æµ‹è¯•åœºæ™¯>æµ‹è¯•åœºæ™¯</h4><p>10ä¸‡æ¬¡å­—ç¬¦ä¸²è¿½åŠ æ“ä½œ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PerformanceTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>LOOP_COUNT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>100_000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Stringæµ‹è¯•</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>start1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>nanoTime</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>LOOP_COUNT</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>s</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=s>&#34;a&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>duration1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>nanoTime</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>start1</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>1_000_000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// StringBufferæµ‹è¯•</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>start2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>nanoTime</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StringBuffer</span><span class=w> </span><span class=n>sbuf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuffer</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>LOOP_COUNT</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>sbuf</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>duration2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>nanoTime</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>start2</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>1_000_000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// StringBuilderæµ‹è¯•</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>start3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>nanoTime</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StringBuilder</span><span class=w> </span><span class=n>sb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuilder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>LOOP_COUNT</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>sb</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>duration3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>nanoTime</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>start3</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>1_000_000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>printf</span><span class=p>(</span><span class=s>&#34;String: %dms%n&#34;</span><span class=p>,</span><span class=w> </span><span class=n>duration1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>printf</span><span class=p>(</span><span class=s>&#34;StringBuffer: %dms%n&#34;</span><span class=p>,</span><span class=w> </span><span class=n>duration2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>printf</span><span class=p>(</span><span class=s>&#34;StringBuilder: %dms%n&#34;</span><span class=p>,</span><span class=w> </span><span class=n>duration3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=æµ‹è¯•ç»“æœ>æµ‹è¯•ç»“æœ</h4><p>JDK17ï¼ŒMac M1</p><div class=table-wrapper><table><thead><tr><th>å®ç°æ–¹å¼</th><th>è€—æ—¶ï¼ˆmsï¼‰</th><th>å†…å­˜åˆ†é…ï¼ˆMBï¼‰</th></tr></thead><tbody><tr><td>String</td><td>4236</td><td>218</td></tr><tr><td>StringBuffer</td><td>12</td><td>0.5</td></tr><tr><td>StringBuilder</td><td>8</td><td>0.3</td></tr></tbody></table></div><h2 id=æœ€ä½³å®è·µ>æœ€ä½³å®è·µ</h2><h3 id=1-é€‰æ‹©ç­–ç•¥>1. é€‰æ‹©ç­–ç•¥</h3><ul><li><p><strong>ä¼˜å…ˆä½¿ç”¨String</strong>ï¼š</p><ul><li>å­˜å‚¨å¸¸é‡é…ç½®ä¿¡æ¯</li><li>ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’</li><li>éœ€è¦ä½œä¸ºMapçš„Keyä½¿ç”¨æ—¶</li></ul></li><li><p><strong>ä½¿ç”¨StringBuilder</strong>ï¼š</p><ul><li>å•çº¿ç¨‹ç¯å¢ƒä¸‹å­—ç¬¦ä¸²æ‹¼æ¥</li><li>SQLè¯­å¥åŠ¨æ€æ„å»º</li><li>æ—¥å¿—æ¶ˆæ¯ç»„è£…</li></ul></li><li><p><strong>ä½¿ç”¨StringBuffer</strong>ï¼š</p><ul><li>å¤šçº¿ç¨‹å…±äº«çš„å­—ç¬¦ä¸²æ“ä½œ</li><li>å…¨å±€æ—¥å¿—ç¼“å†²åŒº</li><li>éœ€è¦åŒæ­¥ä¿®æ”¹çš„å…±äº«èµ„æº</li></ul></li></ul><h3 id=2-æ€§èƒ½ä¼˜åŒ–æŠ€å·§>2. æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// é¢„åˆ†é…å®¹é‡ï¼ˆå‡å°‘æ‰©å®¹æ¬¡æ•°ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>StringBuilder</span><span class=w> </span><span class=n>sb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuilder</span><span class=p>(</span><span class=n>1024</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// é“¾å¼è°ƒç”¨ä¼˜åŒ–</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;Name: &#34;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getName</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;, Age: &#34;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getAge</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// é¿å…åœ¨å¾ªç¯ä¸­ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// é”™è¯¯ç¤ºä¾‹ï¼š</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>output</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Data</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>list</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>output</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>data</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span><span class=w> </span><span class=c1>// äº§ç”Ÿå¤§é‡ä¸´æ—¶å¯¹è±¡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// æ­£ç¡®ç¤ºä¾‹ï¼š</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>StringBuilder</span><span class=w> </span><span class=n>output</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuilder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Data</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>list</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>output</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>data</span><span class=p>.</span><span class=na>getValue</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=3-ç‰¹æ®Šåœºæ™¯å¤„ç†>3. ç‰¹æ®Šåœºæ™¯å¤„ç†</h3><p><strong>å¤šçº¿ç¨‹å®‰å…¨æ“ä½œ</strong>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// ä½¿ç”¨StringBufferçš„åŒæ­¥æ§åˆ¶</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>SharedResource</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>StringBuffer</span><span class=w> </span><span class=n>buffer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuffer</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>safeAppend</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>str</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>synchronized</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>buffer</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>str</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// æˆ–ä½¿ç”¨ThreadLocal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=n>ThreadLocal</span><span class=o>&lt;</span><span class=n>StringBuilder</span><span class=o>&gt;</span><span class=w> </span><span class=n>localBuilder</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ThreadLocal</span><span class=p>.</span><span class=na>withInitial</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuilder</span><span class=p>(</span><span class=n>256</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=å¸¸è§è¯¯åŒº>å¸¸è§è¯¯åŒº</h2><h3 id=è¯¯åŒº1stringbuilderä¸€å®šæ¯”stringbufferå¿«>è¯¯åŒº1ï¼šStringBuilderä¸€å®šæ¯”StringBufferå¿«</h3><ul><li><strong>çœŸç›¸</strong>ï¼šåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ç¡®å®å¦‚æ­¤ï¼Œä½†å·®å¼‚é€šå¸¸åœ¨å¾®ç§’çº§ã€‚å®é™…å¼€å‘ä¸­æ›´åº”å…³æ³¨ä»£ç å¯è¯»æ€§</li></ul><h3 id=è¯¯åŒº2stringbufferå¯ä»¥å®Œå…¨æ›¿ä»£stringbuilder>è¯¯åŒº2ï¼šStringBufferå¯ä»¥å®Œå…¨æ›¿ä»£StringBuilder</h3><ul><li><strong>çº¿ç¨‹å¼€é”€</strong>ï¼šStringBufferçš„åŒæ­¥é”åœ¨ç«äº‰æ¿€çƒˆæ—¶ä¼šå¯¼è‡´æ€§èƒ½éª¤é™</li><li><strong>å¯¹è±¡å¤ç”¨</strong>ï¼šStringBufferå®ä¾‹ä½œä¸ºç±»æˆå‘˜æ—¶å¯èƒ½è¢«é”™è¯¯å…±äº«</li></ul><h2 id=è¿›é˜¶>è¿›é˜¶</h2><h3 id=1-jdk9ä¼˜åŒ–æ”¹è¿›>1. JDK9ä¼˜åŒ–æ”¹è¿›</h3><ul><li><strong>ç´§å‡‘å­—ç¬¦ä¸²</strong>ï¼šæ ¹æ®å†…å®¹è‡ªåŠ¨é€‰æ‹©Latin-1æˆ–UTF-16ç¼–ç </li><li><strong>å­—ç¬¦ä¸²å»é‡</strong>ï¼šG1åƒåœ¾æ”¶é›†å™¨çš„å­—ç¬¦ä¸²å»é‡åŠŸèƒ½ï¼ˆ-XX:+UseStringDeduplicationï¼‰</li></ul><h3 id=2-å†…å­˜æ³„æ¼é˜²èŒƒ>2. å†…å­˜æ³„æ¼é˜²èŒƒ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// å¤§å­—ç¬¦ä¸²å¤„ç†ç¤ºä¾‹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>processHugeData</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>hugeString</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>readHugeFile</span><span class=p>();</span><span class=w> </span><span class=c1>// 1MBå­—ç¬¦ä¸²</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// é”™è¯¯ç”¨æ³•ï¼šæˆªå–å°éƒ¨åˆ†ä½†ä¿ç•™å¤§æ•°ç»„</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>subStr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>hugeString</span><span class=p>.</span><span class=na>substring</span><span class=p>(</span><span class=n>0</span><span class=p>,</span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// æ­£ç¡®åšæ³•ï¼šæ˜¾å¼åˆ›å»ºæ–°å­—ç¬¦ä¸²</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>subStr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=p>(</span><span class=n>hugeString</span><span class=p>.</span><span class=na>substring</span><span class=p>(</span><span class=n>0</span><span class=p>,</span><span class=n>10</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=3-å­—ç¬¦ä¸²æ± æœºåˆ¶>3. å­—ç¬¦ä¸²æ± æœºåˆ¶</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>s1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;java&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>s2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;java&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>s3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>String</span><span class=p>(</span><span class=s>&#34;java&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>s1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>s2</span><span class=p>);</span><span class=w> </span><span class=c1>// trueï¼ˆå¸¸é‡æ± å¼•ç”¨ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>s1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>s3</span><span class=p>);</span><span class=w> </span><span class=c1>// falseï¼ˆå †ä¸­æ–°å¯¹è±¡ï¼‰</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=æ€»ç»“>æ€»ç»“</h2><ol><li><p><strong>åŸºç¡€åŸåˆ™</strong>ï¼š</p><ul><li>ä¼˜å…ˆè€ƒè™‘ä¸å¯å˜æ€§ â†’ String</li><li>å•çº¿ç¨‹å¯å˜éœ€æ±‚ â†’ StringBuilder</li><li>å¤šçº¿ç¨‹å¯å˜éœ€æ±‚ â†’ StringBuffer</li></ul></li><li><p><strong>æ€§èƒ½å…³é”®ç‚¹</strong>ï¼š</p><ul><li>é¿å…ä¸å¿…è¦çš„å­—ç¬¦ä¸²å¯¹è±¡åˆ›å»º</li><li>é¢„ä¼°å®¹é‡å‡å°‘æ‰©å®¹æ¬¡æ•°</li><li>è­¦æƒ•å¤§å­—ç¬¦ä¸²çš„å†…å­˜é©»ç•™</li></ul></li><li><p><strong>å‘å±•è¶‹åŠ¿</strong>ï¼š</p><ul><li>Valhallaé¡¹ç›®çš„å€¼ç±»å‹ï¼ˆinline classï¼‰å¯èƒ½å¸¦æ¥æ–°çš„å­—ç¬¦ä¸²å®ç°</li><li>GraalVMçš„å­—ç¬¦ä¸²ä¼˜åŒ–ç­–ç•¥</li><li>Project Loomå¯¹å­—ç¬¦ä¸²æ“ä½œçš„å½±å“</li></ul></li></ol><p>é€šè¿‡åˆç†é€‰æ‹©å­—ç¬¦ä¸²å¤„ç†ç±»ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ä¿è¯ä»£ç è´¨é‡çš„åŒæ—¶ï¼Œæ˜¾è‘—æå‡åº”ç”¨ç¨‹åºçš„æ€§èƒ½è¡¨ç°ã€‚å»ºè®®åœ¨å…³é”®è·¯å¾„ä»£ç ä¸­ç»“åˆæ€§èƒ½åˆ†æå·¥å…·ï¼ˆå¦‚Async Profilerï¼‰è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–ã€‚</p></section><footer class=article-footer><section class=article-tags><a href=/tags/java/>Java</a>
<a href=/tags/string/>String</a>
<a href=/tags/stringbuffer/>StringBuffer</a>
<a href=/tags/stringbuilder/>StringBuilder</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".main-article");renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/java-string-immutable/><div class=article-details><h2 class=article-title>ä¸ºä»€ä¹ˆ String ä¼šè®¾è®¡æˆä¸å¯å˜ï¼Ÿ</h2></div></a></article><article><a href=/p/java-final/><div class=article-details><h2 class=article-title>å¦‚ä½•ç†è§£ Final å…³é”®å­—ï¼Ÿ</h2></div></a></article><article><a href=/p/write-once-run-anywhere/><div class=article-details><h2 class=article-title>å¦‚ä½•ç†è§£Javaçš„ â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2022 -
2025 XiaoYp - Blog</section><section class=powerby>æƒ³éƒ½æ˜¯é—®é¢˜ï¼Œåšæ‰æ˜¯ç­”æ¡ˆï¼<br>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>